<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="sunhuachuang huachuang20 homepage blog 孙华闯 个人博客 技术文章 react redux javascript">
    <meta name="author" content="sunhuachuang">
    <link rel="icon" href="/images/favicon.ico">
    <title>Sunhuachuang Blog</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div>
        <h2 class="text-success">Happy Hacking Sun. Happy Everyone !</h2>
      </div>
      <hr>
      <a href="/index.html" class="btn btn-success"><- Blog Index</a>
      <h3 class="text-primary"><b>对于redux的几个例子的分析</b></h3>
      <hr>
      <div class="row">
        <div class="col-sm-8">
          <h4>首先是redux的流程分析</h4>
          <p>redux包括三个概念： action，reducer，store</p>
          <p>action: 如同指令。形式：{type, data}，要操作的方式（新建，更新，删除）与数据（id, data）</p>
          <p>reducer: 核心：（old store, action） => new store 。处理action发送过来的指令。</p>
          <p>store: 全局唯一，一切数据的来源地。</p>
          <h4>第一个counter</h4>
          <pre>初始化执行流程：index.html -> index.js -> action -> render -> createStore -> app.js(containers) -> components
            交互流程：components->action->reder->store->container->component</pre>
          <h3>目录结构</h3>
          <h4>主要的</h4>
          <p>d-actions: 存放函数化好的action()</p>
          <p>d-components: react组建存放的地方，相当与view</p>
          <p>d-containers: 构造最顶层模块，连接react及stroe传入变成props</p>
          <p>d-reducers: 存放reduer</p>
          <p>d-store: 需要加入middleware的store，构造特殊的store</p>
          <p>index.html: 初始化页面</p>
          <p>index.js: 进入js(react-redux的标准构造)</p>
          <p>webpack.config.js: webpack打包配置 输入输出配置</p>
          <h4>次要的</h4>
          <p>server.js: 后台server</p>
          <p>package.json: node包管理</p>
          <p>d-node_modules: npm包</p>
            <p>d-test</p>
            <h3>render单纯的处理store与action</h3>
            <p>如果数据需要和服务器交互的化，action里面的data在传到render之前便处理好,
              处理的过程就在middleware。
              render处理增删改查与动作逻辑都是单纯的。都是类似的。</p>
            <p>redux 中的 combineReducers 用于将reducer模块化，分割开。名称相同。</p>
            <p>dispatch一般是一个可用于回调的函数。即dispatch(action)</p>
            <h4>containers中:</h4>
            <p>react-redux 中的connent方法就是将state与dispatch方法通过mapStateToProps与mapDispatchToProps当成props传到react中</p>
            <p>redux 中的 bindActionCreators 方法，将action自动转化为dispatch回调函数。名称相同。
              异步执行的dispatch,调用的时候用回调函数的方式。</p>
            <p>store是一个数据整体。全局唯一一个数据来源。可以在其中以数组形式存入不同数据。json形式的数据.</p>
            <p>action也是json形式的数据。</p>
            <p>初始化时候的store，可以传入initialState作为初始化用的store. 也可以不传。</p>
            <h4>todomvc</h4>
            <p>目录基本一致</p>
            <p>初始化执行流程：<pre>index.html->index.js->store(空(action)->render)->container(app.js)->components(head main)</pre></p>
            <h3>注意点：</h3>
            <p>babel-core polyfill 构建完整的es6运行环境 必须放在最开头</p>
            <h4>todo-with-undo 操作的撤销与不撤销</h4>
            <p>redux-undo ActionCreators
              dispatch(ActionCreators.undo())
              dispatch(ActionCreators.redo())</p>
            <h4>async异步加载</h4>
            <p>需要middleware与logger</p>
            <p>更新两遍stroe，即ui, 第一遍的时候更新更新名称以及指示需要更新。
              更新完随即检查指示，是否再异步更新。</p>
            <p>初始化的store数据为空，但是有结构存在。根据reducer生成</p>
            <p>执行过程：<pre>
 index.html->index.js->
 store(
    render->store{
       selectedReddit: 'reactjs',
       postsByReddit: {}
    }
 )
 ->containers(app.js,props:
    {
       selectedReddit: 'reactjs',
       posts: [],
       isFetching: true,
       lastUpdated: null
       dispatch: dispatch
    }
 )
 ->dispatch(fetchPostsIfNeeded('reactjs')) {
    ->dispatch(requestPosts(reddit))->render()(
       action: {'REQUEST_POSTS', 'reactjs'}
       newStore {
          selectedReddit: 'reactjs',
          postsByReddit: {
              'reactjs': {
                  isFetching: true,
                  didInvalidate: false,
                  items: []
              }
          }
       }
    )
    ->更新ui(不变)
    ->dispatch(receivePosts('reactjs', json)) {
       action: {
          type: RECEIVE_POSTS,
          reddit: 'reactjs',
          posts: json.data.children.map(child => child.data),
          receivedAt: Date.now()
       }
       newState: {
          selectedReddit: 'reactjs',
          postsByReddit: {
              'reactjs': {
                  isFetching: false,
                  didInvalidate: false,
                  items: posts,
                  lastUpdated: receivedAt
              }
          }
       }
    }
    ->更新ui props {
          selectedReddit: 'reactjs',
          posts: json,
          isFetching: false,
          lastUpdated: receivedAt
    }
 }
            </pre></p>
            <h4>universal</h4>
            <h3>执行流程：</h3>
            <pre>`
server/server.js -> client/index.js -> common/store/configureStore.js({"counter":45})
{
    reducers.js=>({"counter":45}, null)=>store{"counter":45};
}
->containers/app.js->component/counter.js
->dispatch(increment)->action:{type:INCREMENT<em>COUNTER}->reducers.js:
              {
              ({"counter":45}, {type:INCREMENT</em>COUNTER}) => {"counter":45}
}
->containers/app.js->component/counter.js
->dispatch(incrementIfOdd)->dispatch(increment)->...
//thunk 中间件的实质就是可以在dispatch中加入其他的dispatch
->dispatch(incrementAsync)->setTimeout(dispatch(increment), 1000)->...
            </pre>
            <h4>real-wrold</h4>
            <h3>目录</h3>
            <p>d-actions</p>
            <p>d-components</p>
            <p>d-containers</p>
            <p>d-middleware /api.js</p>
            <p>d-reducers</p>
            <p>d-store</p>
            <p>routes.js /路由</p>
            <p>server.js</p>
            <p>index.js</p>
            <p>index.html</p>
            <p>package.json</p>
            <p>webpack.config.js</p>
            <p>d-node_modules</p>
            <pre>state结构
{
    entities: {},
    pagination: string,
    errorMessage: string,
    router: string,
}
            </pre>
            <h3>执行流程：</h3>
            <p><pre>
index.htnl-&gt;index.js(store=null)-&gt;container/root.js
-&gt;redux-router:path("/")-&gt;container/app.js: props
{
  errorMessage: string: null
  resetErrorMessage: func: {type: RESET_ERROR_MESSAGE}
  pushState: func: redux-router
  inputValue: string: state.router: " " 即url地址中路由部分
  children: node :null redux-router中注入的children，即user与reps部分
}
-&gt;component/Explore.js
-&gt;handleChange()-&gt;pushState(null, `/${nextValue}
            </pre>
            </p>
            <nav>
              <ul class="pager">
                <li style="float:left;padding-left:2em;"><a href="/python/flask-dir.html"><< flask 目录结构</a></li>
                <li style="float:right;padding-right:2em;"><a href="/php/module-already-load.html">PHP module warning >></a></li>
              </ul>
            </nav>
        </div>
        <div class="col-sm-3 col-sm-offset-1">
          <div>
            <h4>About Me</h4>
            <p>Name: <em>sunhuachuang (孙华闯)</em></p>
            <p><a href="/about_en.html">English Introduction</a> <a href="/about_zh.html">中文简介</a></p>
          </div>
          <hr>
          <div>
            <h4>Archives</h4>
            <ol class="list-unstyled">
              <li><a href="/2018.html">2018</a></li>
              <li><a href="/2017.html">2017</a></li>
              <li><a href="/2016.html">2016</a></li>
            </ol>
          </div>
          <hr>
          <div>
            <h4>Elsewhere</h4>
            <ol class="list-unstyled">
              <li><p class="text-success">E: huachuang20@gmail.com</p></li>
              <li><a href="https://github.com/sunhuachuang">GitHub</a></li>
              <li><a href="http://weibo.com/u/3268988844?is_all=1">WeiBo</a></li>
              <li><a href="https://www.linkedin.com/in/huachuang-sun-6548a3105">Linkedin</a></li>
              <li><a href="https://twitter.com/huachuang20">Twitter</a></li>
            </ol>
          </div>
        </div>
      </div>
      <hr>
    </div>
  </body>
</html>
